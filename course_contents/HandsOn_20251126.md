# Docker Hands-on training (26-11-2025)

1. Biological context (bowtie2 + feature counts for prokaryotes)
2. Data to be used
3. Dockerfile (system,work dir, Software, script examples)
4. image- docker build
5. mounting the data
6. docker run -v data_to_moount script.sh

## Initial considerations
In this course, you can work on your laptop if you have installed the Docker in your machine. For local installation:

- Mac: <https://docs.docker.com/desktop/setup/install/mac-install/>
- Linux: <https://docs.docker.com/engine/install/>
- Windows: <https://docs.docker.com/desktop/setup/install/windows-install/>


Alternatively use Github Codespaces to avoid any system incompatibility. You can open directly a GitHub codespace for this specific repository here: [![Open in GitHub Codespaces](https://github.com/codespaces/badge.svg)](https://codespaces.new/biosustain/dsp_docker_training) 

## Data and biological context
 Link to Sebastian slides

## Running a container

Once the docker daemon is running you can run containers, we will start with the `hello-world` container, which is hosted on [Docker Hub](https://hub.docker.com/).

In your command line, run the publicly available `hello-world` container:

```
docker run hello-world
```
We usually run that to check that our installation is working correctly. If you read `'Hello from Docker!'` everything is fine for now.

Please read the information given. Docker first tried to check if we had the container locally, as we did not, the online container repositories were checked. As the container was found, it was donwloaded, and run.

## Pulling a container

Pull the publicly available `debian:bookworm-slim` container and verify it has been downloaded:

```
docker pull debian:bookworm-slim
```

To check which containers you have pulled, you can use `images` command with the following syntax:
```
docker images
``` 

## Writing our Dockerfile

What do we need?
- OS system
- Working directory
- Instructions to download and install software and place it on the executables path
    - bowtie2: align reads to a reference
    - feature counts: count transcripts
    - samtools: deal with .bam files
- copy an script example

Open a file called Dockerfile

Which OS system we want to use
```{code-block} docker
FROM python:3.13
```

Which OS system we want to use
```{code-block} docker
FROM python:3.13
```

Creating Working directory
```{code-block} docker
WORKDIR /app
```

Updating the downloader manager `apt-get` and installing the software that can be found in apt-get (easier solution). IN this case bowtie2 (the aligner) and samtools (to deal with a bam file):
```{code-block} docker
RUN apt-get update && apt-get -y install bowtie2 samtools
``` 

Not all tools needed can be installed with `apt-get` and we may need to download from a particular URL as in the case of feature counts.
This process is a bit more involved. See here, we need to:
- download it
- change the name as it downloads with a weird name
- uncompress it
- specify in which path there is the executable

```{code-block} docker

# Download feature counts (package called subread)
ADD https://sourceforge.net/projects/subread/files/subread-2.0.8/subread-2.0.8-Linux-x86_64.tar.gz/download ./

# Change name (why?)
RUN mv download subread-2.0.8-Linux-x86_64.tar.gz

# Uncompress
RUN tar -xzf subread-2.0.8-Linux-x86_64.tar.gz && \
    rm subread-2.0.8-Linux-x86_64.tar.gz

# Specify the path to the executable
ENV PATH="${PATH}:/app/STAR_2.7.11b/Linux_x86_64_static:/app/subread-2.0.8-Linux-x86_64/bin/"

```

Finally we add an example script to run the container.
```{code-block} docker
COPY scripts/ ./scripts/
```

When you have a Dockerfile, you can build it to a docker image with the `build` command using the following syntax:
`docker build --tag <my-image-name:my-optional-image-tag> <my-location-path>`, where `--tag` is equivalent to `-t` and `<my-location-path>` can be referenced with `.`

Let's build your docker file to an image:

```{code-block} bash
docker build -t align_count -f docker_file/Dockerfile .
```

## Running an container in interactive mode

While we would rather reccomend using _virtual environments_ for running speciffic environments interactively, it can be handy to be familiar with docker's ability to run a container in interactive mode. This is just useful to check if the expected software is present within a container, but we do not recommend to change anything in the container, instead do it in the Dockerfile.

This is done by adding the two command line inputs to the `docker run` command: `--interactive` and `--tty`,  which have the equivalents `-i` and `-t`. 

They can thus be run with the following syntax: `docker run -it <container-name> <command>`

We will launch the BASH shell (`bash`) in the `align_count` image:
```{code-block} bash
docker run -it align_count bash
```

## Running the image mounting the data

mount path must be absolute.

```{code-block} bash
docker run --rm -v ./data/:/app/data -v ./results/:/app/results align_count ./scripts/align_and_count_prok.sh
```

Add Dockerfile reference for the instructions of each of the commands. Add the link!